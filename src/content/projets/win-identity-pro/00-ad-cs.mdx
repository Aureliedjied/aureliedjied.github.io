---
title: "PKI : D√©ploiement du r√¥le AD CS"
description: "Mise en place d‚Äôune autorit√© de certification d‚Äôentreprise pour √©tablir la confiance num√©rique au sein du domaine."
tags: ["Active Directory", "S√©curit√©", "PKI", "Audit"]
pubDate: 2026-01-30
category: "windows"
slug: "ad-cs"
---

import SeriesStepper from '../../../components/SeriesStepper.astro';
import { WIN_IDENTITY_PRO } from '../../../constants/series';
import NextStep from '../../../components/NextStep.astro';

<SeriesStepper 
  seriesTitle="Certificat AD CS" 
  steps={WIN_IDENTITY_PRO} 
  currentStepIndex={0} 
/>

L‚Äô**Active Directory Certificate Services (AD CS)** constitue la fondation de la confiance num√©rique d‚Äôun environnement Windows.  
Dans cette √©tape du lab, l‚Äôobjectif n‚Äôest pas seulement d‚Äôinstaller une autorit√© de certification, mais de poser une **racine de confiance propre, ma√Ætris√©e et durcie**, capable de supporter les futurs besoins : authentification forte, LDAPS, chiffrement des services et authentification machine.

Le d√©ploiement d'une **PKI (Public Key Infrastructure)** est donc abord√© ici avec une logique de **s√©curit√©, de tra√ßabilit√© et de moindre privil√®ge**.

---

## üèóÔ∏è √âtape 1 : Installer le r√¥le

Je commence par ajouter le r√¥le **Services de certificats Active Directory** depuis le Gestionnaire de serveur.  
L‚Äôobjectif est de rester sur une **installation minimale** :

- Je s√©lectionne uniquement **Autorit√© de certification**
- Je **n‚Äôactive pas l‚Äôinscription Web** afin d‚Äô√©viter d‚Äôinstaller IIS et d‚Äôaugmenter la surface d‚Äôattaque du serveur

Avant de lancer la configuration, je v√©rifie que le **nom DNS du serveur est d√©finitif**, car il sera inscrit dans les certificats √©mis par la CA.

> ‚ùó Une autorit√© de certification ne doit pas changer d‚Äôidentit√© r√©seau apr√®s son d√©ploiement.

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center">
      <img src="/images/projets/win-identity-pro/ad-cs/install-adcs.png" alt="Installation du r√¥le AD CS" class="rounded-lg border border-white/10 shadow-md" /> 
      <p class="text-[0.65rem] italic opacity-50 mt-2">S√©lection du r√¥le Autorit√© de certification.</p>
  </div>
    <div class="flex flex-col items-center">
      <img src="/images/projets/win-identity-pro/ad-cs/install-ca.png" alt="Installation minimale" class="rounded-lg border border-white/10 shadow-md" /> 
      <p class="text-[0.65rem] italic opacity-50 mt-2">Installation sans service Web pour r√©duire l‚Äôexposition.</p>
  </div>
</div>

---

## üîê √âtape 2 : Configurer l‚ÄôAutorit√© de Certification

Je d√©ploie une **Autorit√© de certification d‚Äôentreprise racine**, int√©gr√©e √† Active Directory.  
Ce choix permet plus tard :

- l‚Äô**auto-enr√¥lement** via GPO  
- l‚Äôapprobation automatique des certificats pour les mod√®les autoris√©s  

Je g√©n√®re ensuite une **nouvelle cl√© priv√©e RSA 4096 bits** avec un algorithme de hachage **SHA512**, dans une logique de durcissement cryptographique au-del√† du minimum recommand√© (SHA256 restant le standard courant).

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/adcs-4.png" alt="Cl√© priv√©e" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Cr√©ation d'une nouvelle cl√© priv√©e s√©curis√©e.</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/adcs-fin.png" alt="R√©sum√© final" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Confirmation de la configuration r√©ussie</p>
  </div>
</div>

---

## üõ°Ô∏è √âtape 3 : Segmenter l‚Äôadministration de la PKI (Moindre privil√®ge)

Administrer une PKI avec un compte **Domain Admin** cr√©erait un point de compromission critique.  
Je mets donc en place une **identit√© d‚Äôexploitation d√©di√©e** : **`adm-pki`**.

### üë§ Cr√©ation du compte d‚Äôadministration PKI

Le compte est :

- isol√© dans une OU d√©di√©e aux comptes d‚Äôadministration :  
  **`00_ADMINS > PKI`**
- utilis√© uniquement pour l‚Äôexploitation quotidienne de l‚Äôautorit√© de certification

Cette s√©paration permet d‚Äôidentifier clairement les actions PKI dans les journaux et de limiter les risques en cas de compromission.

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/adm-pki.png" alt="Cr√©ation du compte adm-pki" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Cr√©ation du compte d‚Äôadministration d√©di√© √† la PKI, isol√© dans son groupe</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/adm-pki2.png" alt="OU PKI" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Attribution des groupes n√©c√©ssaires uniquement</p>
  </div>
</div>

---

### üìú Gestion du groupe **Editeurs de certificats**

Le groupe **√âditeurs de certificats** permet de publier des certificats dans Active Directory (attributs des objets utilisateurs et ordinateurs).

Dans une configuration par d√©faut, le **compte machine du serveur CA** peut en √™tre membre.  
Ici, je fais le choix d‚Äôun mod√®le plus strict :

- üîª Retrait du compte machine **`SRV-AD-01$`**
- ‚ûï Ajout exclusif du compte **`adm-pki`**

üëâ Cela permet que la publication des certificats dans l‚Äôannuaire soit r√©alis√©e par une **identit√© nominative** plut√¥t que par un compte machine, ce qui am√©liore la tra√ßabilit√©. 

Ce choix rel√®ve d‚Äôun **durcissement organisationnel**, et non d‚Äôune obligation technique.
Depuis la console **`certsrv.msc`**, j‚Äôouvre les propri√©t√©s de l‚Äôautorit√© puis l‚Äôonglet **S√©curit√©** afin de d√©l√©guer uniquement les droits n√©cessaires au compte `adm-pki` :

- **Lire**
- **√âmettre et g√©rer des certificats**

Ces permissions permettent la gestion quotidienne (√©mission, r√©vocation, suivi des demandes) sans autoriser de modifications structurelles.

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/adm-pki3.png" alt="Membres du groupe √âditeurs de certificats" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Restriction des membres du groupe Certificate Publishers.</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/adm-pki-cert.png" alt="Permissions de la CA" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">D√©l√©gation des droits d‚Äô√©mission sur l‚Äôautorit√© de certification.</p>
  </div>
</div>

---


### üîê S√©paration des r√¥les d‚Äôadministration

La gestion avanc√©e de la PKI reste strictement limit√©e aux comptes **Tier 0**, notamment :

- modification de la configuration de la CA  
- gestion des mod√®les de certificats sensibles  
- maintenance de la hi√©rarchie de certification  

Ainsi, le compte **`adm-pki`** est un compte d‚Äô**exploitation**, pas un compte d‚Äô**architecture**.

> üéØ Cette s√©paration r√©duit fortement l‚Äôimpact potentiel d‚Äôune compromission et s‚Äôaligne avec les bonnes pratiques de s√©curisation des environnements Active Directory.

---

## üîç √âtape 4 : Activer l‚Äôaudit 

Une PKI sans journalisation fiable constitue un angle mort de s√©curit√©.  
J‚Äôactive donc l‚Äôaudit des √©v√©nements de l‚Äôautorit√© de certification en modifiant la GPO **DOM - S - Advanced_Auditing** pour activer l‚Äôoption " Auditer les services de certifications " :


Apr√®s application, la sous-cat√©gorie **Services de certification** passe bien en **Succ√®s et √âchec**, que l'on peut v√©rifier directement via powershell.

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/audit-cert.png" alt="Membres du groupe √âditeurs de certificats" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Auditer les succ√®s et √©checs.</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-identity-pro/ad-cs/audit-pwshell-ok.png" alt="Permissions de la CA" class="rounded-lg border border-white/10 shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">V√©rification de l'audit avec la commande auditpol /get</p>
  </div>
</div>
---

## üß¨ √âtape 5 : G√©rer les mod√®les de certificats

Je duplique un mod√®le Kerberos afin de cr√©er une version adapt√©e √† mon environnement de lab.

J‚Äôy configure notamment :
- l‚Äôajout du **SAN DNS**, indispensable pour la compatibilit√© avec les usages TLS modernes  
- l‚Äô**exportation de la cl√© priv√©e** (choix volontairement p√©dagogique pour le lab, d√©conseill√© pour des comptes sensibles en production)

Je v√©rifie ensuite via **ADSI Edit** que le mod√®le est bien publi√© dans la partition de configuration d‚ÄôActive Directory, au sein des objets de services de cl√© publique.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 450px;">
    <img src="/images/projets/win-identity-pro/ad-cs/cert-ad-inscrit.png" alt="ADSI console" style="width: 130%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Le certificat est bien g√©n√©r√© et enregistr√© dans l'ADSI</p>
  </div>
</div>
---

## ‚úÖ √âtape 6 : V√©rifier la sant√© de la PKI

Pour terminer, j‚Äôutilise **PKIView (`pkiview.msc`)** afin de contr√¥ler :

- la hi√©rarchie de certification  
- la validit√© des certificats d‚Äôautorit√©  
- la disponibilit√© des points **AIA** et **CDP**

Tous les indicateurs sont au vert : la cha√Æne de confiance est fonctionnelle et les points de distribution sont accessibles.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 450px;">
    <img src="/images/projets/win-identity-pro/ad-cs/pki-ok.png" alt="PKIview" style="width: 130%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Emplacement AIA et CDP du certificat OK</p>
  </div>
</div>

---

## üß© √âtape 7 : V√©rifier le certificat via la console MMC

Une fois la PKI valid√©e c√¥t√© infrastructure, je v√©rifie que le **certificat de l‚Äôautorit√© de certification** est bien install√© dans le magasin de certificats du serveur.

Pour cela, j‚Äôutilise la **console MMC** afin d‚Äôinspecter les certificats de l‚Äôordinateur local.

### üîß Ajout du composant logiciel enfichable Certificats

1. Lancer `mmc.exe`
2. Menu **Fichier ‚Üí Ajouter/Supprimer un composant logiciel enfichable**
3. S√©lectionner **Certificats**, "ajouter"
4. Choisir **Compte d‚Äôordinateur**
5. S√©lectionner **Ordinateur local**

Cette manipulation permet d‚Äôacc√©der au magasin de certificats syst√®me, et non au magasin utilisateur.

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
  <img src="/images/projets/win-identity-pro/ad-cs/mmc1.png" alt="Ajout composant enfichable MMC" class="rounded-lg border border-white/10 shadow-md" />
  <img src="/images/projets/win-identity-pro/ad-cs/mmc2.png" alt="Choix du composant Certificats" class="rounded-lg border border-white/10 shadow-md" />
  <img src="/images/projets/win-identity-pro/ad-cs/mmc3.png" alt="S√©lection compte ordinateur" class="rounded-lg border border-white/10 shadow-md" />
  <img src="/images/projets/win-identity-pro/ad-cs/mmc4.png" alt="Ordinateur local" class="rounded-lg border border-white/10 shadow-md" />
</div>

---

### üîç V√©rification du certificat de la CA

Une fois le composant ajout√©, je navigue dans :

**Certificats (ordinateur local) ‚Üí Autorit√©s de certification racines de confiance ‚Üí Certificats**

Le certificat de mon autorit√© de certification d‚Äôentreprise appara√Æt bien dans le magasin.  
Cela confirme que :

- la CA est correctement install√©e
- le certificat racine est bien approuv√© localement
- la cha√Æne de confiance peut fonctionner pour les services du serveur

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="width: 100%; max-width: 900px; display: flex; flex-direction: column; align-items: center;">
    <img src="/images/projets/win-identity-pro/ad-cs/mmc5.png" alt="Certificat racine visible dans MMC" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.75rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Le certificat de l‚Äôautorit√© est bien pr√©sent dans le magasin racine de confiance</p>
  </div>
</div>

---

Cette v√©rification c√¥t√© syst√®me compl√®te les contr√¥les PKIView : on valide √† la fois l‚Äôinfrastructure de confiance **et** sa pr√©sence effective sur le serveur.



La PKI interne est d√©sormais **op√©rationnelle, segment√©e et correctement audit√©e**.  
Elle constitue la **brique de confiance** n√©cessaire pour s√©curiser les flux critiques du domaine.

La prochaine √©tape consiste √† exploiter cette infrastructure pour chiffrer les communications LDAP via **LDAPS**.

<NextStep 
  title="S√©curisation LDAPS" 
  description="Utilisation de nos mod√®les pour chiffrer les √©changes de l'annuaire sur le port 636." 
  link="/projets/win-identity-pro/ldaps" 
/>
