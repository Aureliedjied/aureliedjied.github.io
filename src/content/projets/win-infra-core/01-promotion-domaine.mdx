---
title: "Hardening et Promouvoir le domaine"
description: "DÃ©ploiement d'une nouvelle forÃªt Active Directory et application des premiÃ¨res mesures de durcissement selon les prÃ©conisations ANSSI."
tags: ["Windows Server", "Active Directory", "SÃ©curitÃ©"]
pubDate: 2026-01-12
slug: "promotion-domaine"
---
import SeriesStepper from '../../../components/SeriesStepper.astro';
import NextStep from '../../../components/NextStep.astro';
import { WIN_INFRA_CORE } from '../../../constants/series';

<SeriesStepper 
  seriesTitle="Hardening et Promouvoir le domaine" 
  steps={WIN_INFRA_CORE} 
  currentStepIndex={1} 
/>

# Promotion & Durcissement du ContrÃ´leur de Domaine

La prÃ©paration d'un ContrÃ´leur de Domaine (DC) ne se limite pas Ã  l'installation des rÃ´les Active Directory. Pour garantir un niveau de sÃ©curitÃ© conforme aux attentes de l'ANSSI, le systÃ¨me doit Ãªtre durci **avant mÃªme la crÃ©ation de la forÃªt**, lorsque le serveur est encore vierge de toute stratÃ©gie de domaine.

Cette approche permet de rÃ©duire drastiquement la surface dâ€™attaque dÃ¨s lâ€™origine et dâ€™Ã©viter lâ€™introduction de protocoles obsolÃ¨tes dans lâ€™environnement Active Directory.

## ğŸ›¡ï¸ Durcissement PrÃ©-Promotion (Phase 1)

L'objectif est de rÃ©duire la surface d'attaque en dÃ©sactivant les protocoles de rÃ©solution de noms et de communication rÃ©seau hÃ©ritÃ©s, frÃ©quemment exploitÃ©s lors des phases de compromission initiale.

### 1. DÃ©sactivation de LLMNR
LLMNR est un vecteur majeur d'interception de hashs NTLM. En l'absence de domaine et donc de GPO, l'intervention s'effectue directement dans le registre afin d'imposer la dÃ©sactivation.

En cas d'Ã©chec DNS, LLMNR diffuse la requÃªte en clair sur le rÃ©seau local, ce qui permet Ã  un attaquant de capturer et relayer des identifiants via des attaques de type *Man-in-the-Middle*.

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/llmnr-desactived.png" alt="DÃ©sactivation LLMNR" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">CrÃ©ation de la clÃ© de registre EnableMulticast</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/llmnr-verif-0.png" alt="VÃ©rification LLMNR" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Audit : Valeur positionnÃ©e Ã  0 (DÃ©sactivÃ©)</p>
  </div>
</div>

### 2. DÃ©sactivation de SMBv1
Protocole historique dÃ©sormais obsolÃ¨te, SMBv1 est dÃ©pourvu de mÃ©canismes de sÃ©curitÃ© modernes. Il a notamment Ã©tÃ© utilisÃ© comme vecteur de propagation lors dâ€™attaques massives telles que WannaCry.

Dans ce cas prÃ©cis, la fonctionnalitÃ© **SMB 1.0/CIFS** nâ€™est pas installÃ©e sur le systÃ¨me : le protocole est donc dÃ©jÃ  absent, ce qui confirme une configuration conforme aux standards de sÃ©curitÃ© actuels.

<div class="flex flex-col items-center my-8">
  <img src="/images/projets/win-infra-core/promo/smb1-desactived.png" alt="DÃ©sactivation SMBv1" class="max-w-[400px] w-full rounded-lg border border-white/10 shadow-md" />
  <p class="text-[0.65rem] italic opacity-50 mt-2">VÃ©rification de l'Ã©tat du rÃ´le : Available (Non installÃ©)</p>
</div>

### 3. DÃ©sactivation de NetBIOS
NetBIOS est un protocole particuliÃ¨rement bavard qui expose inutilement le nom et certaines informations du serveur aux autres machines du segment rÃ©seau. Son maintien augmente la surface dâ€™attaque et facilite la reconnaissance par un attaquant.

Sa dÃ©sactivation constitue une Ã©tape clÃ© du durcissement rÃ©seau, en particulier avant lâ€™introduction du serveur dans un environnement Active Directory.

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/netbios-active.png" alt="NetBIOS ActivÃ©" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Ã‰tat initial : NetbiosOptions vide (0)</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/netbios-desactived.png" alt="NetBIOS DÃ©sactivÃ©" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">ExÃ©cution du script de dÃ©sactivation</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/netbios-verif.png" alt="VÃ©rification NetBIOS" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Audit final : NetbiosOptions = 2</p>
  </div>
</div>

---

## VÃ©rifications

AprÃ¨s redÃ©marrage, une vÃ©rification rapide via `netstat` permet de confirmer lâ€™Ã©tat du serveur.  
Seuls les services strictement nÃ©cessaires au rÃ´le futur (DNS, SMB, RPC) sont en Ã©coute.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/netbios-verif.png" alt="ParamÃ¨tres NetBIOS via IPv4 avancÃ©" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">AccÃ¨s aux paramÃ¨tres avancÃ©s NetBIOS via les propriÃ©tÃ©s IPv4</p>
  </div>
</div>



Cette validation volontairement simple permet de sâ€™assurer quâ€™aucun service superflu nâ€™est exposÃ© avant la promotion du serveur en ContrÃ´leur de Domaine.

<div class="mt-12 p-6 border border-green-500/30 bg-green-500/5 rounded-xl text-center">
    <span class="text-green-500 font-bold">âœ… Ã‰tat Final :</span> Le ContrÃ´leur de Domaine est opÃ©rationnel, durci et prÃªt Ã  accueillir la structure des UnitÃ©s d'Organisation.
</div>

---

## ğŸš€ Promotion : CrÃ©ation de la ForÃªt

Le socle systÃ¨me est dÃ©sormais sain, maÃ®trisÃ© et conforme aux bonnes pratiques de sÃ©curitÃ©.  
La promotion du serveur `SRV-AD-01` peut Ãªtre engagÃ©e pour crÃ©er la forÃªt racine Active Directory.

Les paramÃ¨tres appliquÃ©s localement lors de cette phase seront par la suite consolidÃ©s et renforcÃ©s via des stratÃ©gies de groupe (GPO) au niveau du domaine.

### Configuration du Domaine
* **Nom de la forÃªt** : `infra.formation.local`
* **Niveau fonctionnel** : Windows Server 2016
* **Services** : Catalogue global (GC) et DNS intÃ©grÃ©s

La promotion du serveur en ContrÃ´leur de Domaine sâ€™effectue via lâ€™assistant Active Directory. Pour y accÃ©der, ouvrir le drapeau jaune qui proposera de " Promouvoir ce serveur en controleur de domaine ".
Les choix effectuÃ©s Ã  cette Ã©tape conditionnent la stabilitÃ©, la sÃ©curitÃ© et lâ€™Ã©volutivitÃ© de la forÃªt.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/promotion-ad.png" alt="Lancement de la promotion Active Directory" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Lancement de la promotion du serveur en ContrÃ´leur de Domaine</p>
  </div>
</div>

#### CrÃ©ation de la forÃªt
Le choix **Â« Ajouter une nouvelle forÃªt Â»** permet dâ€™initialiser un environnement Active Directory isolÃ©, maÃ®trisÃ© et conforme aux bonnes pratiques.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/creation-foret.png" alt="CrÃ©ation de la forÃªt Active Directory" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">CrÃ©ation de la forÃªt racine infra.formation.local</p>
  </div>
</div>

**DÃ©lÃ©gation DNS**  
La crÃ©ation dâ€™une dÃ©lÃ©gation DNS **nâ€™est pas cochÃ©e**.  
Dans le cadre dâ€™une nouvelle forÃªt racine, le serveur hÃ©berge lui-mÃªme le service DNS intÃ©grÃ© Ã  Active Directory.  
Une dÃ©lÃ©gation nâ€™est pertinente que dans un scÃ©nario de sous-domaine ou dâ€™intÃ©gration Ã  une infrastructure DNS existante.


<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/no-dns.png" alt="ne pas ajouter de dns" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">ne pas cocher le DNS</p>
  </div>
</div>


#### Mot de passe DSRM
Le mot de passe **Directory Services Restore Mode (DSRM)** est dÃ©fini Ã  cette Ã©tape. J'ai choisi une passphrase composÃ©e de chiffres et caractÃ¨res spÃ©ciaux.
Il permet lâ€™accÃ¨s au contrÃ´leur de domaine en mode restauration et doit Ãªtre :
- robuste,
- stockÃ© de maniÃ¨re sÃ©curisÃ©e,
- distinct des comptes administrateurs du domaine.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/mdp-dsrm.png" alt="DÃ©finition du mot de passe DSRM"  style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">DÃ©finition du mot de passe DSRM</p>
  </div>
</div>

Lâ€™assistant propose par dÃ©faut des emplacements standards pour la base de donnÃ©es, les journaux et le dossier **SYSVOL**.  
Dans ce contexte de laboratoire maÃ®trisÃ©, les chemins par dÃ©faut sont conservÃ©s afin de garantir la compatibilitÃ© maximale avec les outils et bonnes pratiques Microsoft.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/sysvol.png" alt="Configuration du dossier SYSVOL"  style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Emplacement de la base AD, des journaux et du dossier SYSVOL</p>
  </div>
</div>


#### Installation de la forÃªt
Cette Ã©tape rÃ©capitule lâ€™ensemble des paramÃ¨tres choisis prÃ©cÃ©demment.  
Elle permet une derniÃ¨re vÃ©rification avant lâ€™exÃ©cution effective de la promotion.

Une fois validÃ©e, lâ€™installation initialise :
- le schÃ©ma Active Directory,
- les partitions de la forÃªt,
- le service DNS intÃ©grÃ©,
- le partage SYSVOL.


<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/installation-foret.png" alt="Installation de la forÃªt Active Directory"  style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">RÃ©capitulatif et lancement de lâ€™installation de la forÃªt</p>
  </div>
</div>

La promotion se conclut par la validation des paramÃ¨tres et le redÃ©marrage automatique du serveur.  
Ã€ lâ€™issue du redÃ©marrage, lâ€™ouverture de session sâ€™effectue dÃ©sormais via le compte **INFRA\\Administrateur**, confirmant la crÃ©ation effective du domaine.


<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/open-admin-ad.png" alt="ouverture session admin" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Ouverture de la session INFRA\Administrateur</p>
  </div>
</div>



<NextStep 
  href="/projets/audit-pingcastle" 
  title="Auditer la sÃ©curitÃ©" 
/>
