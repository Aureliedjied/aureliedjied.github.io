---
title: "Hardening et Promouvoir le domaine"
description: "DÃ©ploiement d'une nouvelle forÃªt Active Directory et application des premiÃ¨res mesures de durcissement selon les prÃ©conisations ANSSI."
tags: ["Windows Server", "Active Directory", "SÃ©curitÃ©"]
pubDate: 2026-01-14
slug: "promotion-domaine"
---
import SeriesStepper from '../../../components/SeriesStepper.astro';
import NextStep from '../../../components/NextStep.astro';
import { WIN_INFRA_CORE } from '../../../constants/series';

<SeriesStepper 
  seriesTitle="Hardening et Promouvoir le domaine" 
  steps={WIN_INFRA_CORE} 
  currentStepIndex={1} 
/>

# Promotion & Durcissement du ContrÃ´leur de Domaine

La prÃ©paration d'un ContrÃ´leur de Domaine (DC) ne se limite pas Ã  l'installation des rÃ´les Active Directory. Pour garantir un niveau de sÃ©curitÃ© conforme aux attentes de l'ANSSI, le systÃ¨me doit Ãªtre durci **avant mÃªme la crÃ©ation de la forÃªt**, lorsque le serveur est encore vierge de toute stratÃ©gie de domaine.

Cette approche permet de rÃ©duire drastiquement la surface dâ€™attaque dÃ¨s lâ€™origine et dâ€™Ã©viter lâ€™introduction de protocoles obsolÃ¨tes dans lâ€™environnement Active Directory.

## ğŸ›¡ï¸ Durcissement PrÃ©-Promotion 

L'objectif est de rÃ©duire la surface d'attaque en dÃ©sactivant les protocoles de rÃ©solution de noms et de communication rÃ©seau hÃ©ritÃ©s, frÃ©quemment exploitÃ©s lors des phases de compromission initiale.

### 1. DÃ©sactivation de LLMNR
LLMNR est un vecteur majeur d'interception de hashs NTLM. En l'absence de domaine et donc de GPO, l'intervention s'effectue directement dans le registre afin d'imposer la dÃ©sactivation.

En cas d'Ã©chec DNS, LLMNR diffuse la requÃªte en clair sur le rÃ©seau local, ce qui permet Ã  un attaquant de capturer et relayer des identifiants via des attaques de type *Man-in-the-Middle*.

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/llmnr-desactived.png" alt="DÃ©sactivation LLMNR" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">CrÃ©ation de la clÃ© de registre EnableMulticast</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/llmnr-verif-0.png" alt="VÃ©rification LLMNR" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Audit : Valeur positionnÃ©e Ã  0 (DÃ©sactivÃ©)</p>
  </div>
</div>

### 2. DÃ©sactivation de SMBv1
Protocole historique dÃ©sormais obsolÃ¨te, SMBv1 est dÃ©pourvu de mÃ©canismes de sÃ©curitÃ© modernes. Il a notamment Ã©tÃ© utilisÃ© comme vecteur de propagation lors dâ€™attaques massives telles que WannaCry.

Dans ce cas prÃ©cis, la fonctionnalitÃ© **SMB 1.0/CIFS** nâ€™est pas installÃ©e sur le systÃ¨me : le protocole est donc dÃ©jÃ  absent, ce qui confirme une configuration conforme aux standards de sÃ©curitÃ© actuels.

<div class="flex flex-col items-center my-8">
  <img src="/images/projets/win-infra-core/promo/smb1-desactived.png" alt="DÃ©sactivation SMBv1" class="max-w-[400px] w-full rounded-lg border border-white/10 shadow-md" />
  <p class="text-[0.65rem] italic opacity-50 mt-2">VÃ©rification de l'Ã©tat du rÃ´le : Available (Non installÃ©)</p>
</div>

### 3. DÃ©sactivation de NetBIOS
NetBIOS est un protocole particuliÃ¨rement bavard qui expose inutilement le nom et certaines informations du serveur aux autres machines du segment rÃ©seau. Son maintien augmente la surface dâ€™attaque et facilite la reconnaissance par un attaquant.

Sa dÃ©sactivation constitue une Ã©tape clÃ© du durcissement rÃ©seau, en particulier avant lâ€™introduction du serveur dans un environnement Active Directory.

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-8">
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/netbios-active.png" alt="NetBIOS ActivÃ©" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Ã‰tat initial : NetbiosOptions vide (0)</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/netbios-desactived.png" alt="NetBIOS DÃ©sactivÃ©" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">ExÃ©cution du script de dÃ©sactivation</p>
  </div>
  <div class="flex flex-col items-center">
    <img src="/images/projets/win-infra-core/promo/netbios-verif.png" alt="VÃ©rification NetBIOS" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p class="text-[0.65rem] italic opacity-50 mt-2">Audit final : NetbiosOptions = 2</p>
  </div>
</div>

---

## VÃ©rifications

AprÃ¨s redÃ©marrage, une vÃ©rification rapide via `netstat` permet de confirmer lâ€™Ã©tat du serveur.  
Seuls les services strictement nÃ©cessaires au rÃ´le futur (DNS, SMB, RPC) sont en Ã©coute.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/netstat.png" alt="ParamÃ¨tres NetBIOS via IPv4 avancÃ©" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">AccÃ¨s aux paramÃ¨tres avancÃ©s NetBIOS via les propriÃ©tÃ©s IPv4</p>
  </div>
</div>


Cette validation volontairement simple permet de sâ€™assurer quâ€™aucun service superflu nâ€™est exposÃ© avant la promotion du serveur en ContrÃ´leur de Domaine.


---

## ğŸš€ Promotion : CrÃ©ation de la ForÃªt

Le socle systÃ¨me est dÃ©sormais sain, maÃ®trisÃ© et conforme aux bonnes pratiques de sÃ©curitÃ©.  
La promotion du serveur `SRV-AD-01` peut Ãªtre engagÃ©e pour crÃ©er la forÃªt racine Active Directory.

Les paramÃ¨tres appliquÃ©s localement lors de cette phase seront par la suite consolidÃ©s et renforcÃ©s via des stratÃ©gies de groupe (GPO) au niveau du domaine.

### Configuration du Domaine
<div class="my-6">
  <ul>
    <li><strong>Nom de la forÃªt :</strong> <code>infra.formation.local</code></li>
    <li><strong>Niveau fonctionnel :</strong> <code>Windows Server 2016</code></li>
    <li><strong>Services:</strong> Catalogue global et DNS </li>
  </ul>
</div>

La promotion du serveur en ContrÃ´leur de Domaine sâ€™effectue via lâ€™assistant Active Directory. Pour y accÃ©der, ouvrir le drapeau jaune qui proposera de " Promouvoir ce serveur en controleur de domaine ".
Les choix effectuÃ©s Ã  cette Ã©tape conditionnent la stabilitÃ©, la sÃ©curitÃ© et lâ€™Ã©volutivitÃ© de la forÃªt.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/promotion-ad.png" alt="Lancement de la promotion Active Directory" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Lancement de la promotion du serveur en ContrÃ´leur de Domaine</p>
  </div>
</div>

### CrÃ©ation de la forÃªt
Le choix **Â« Ajouter une nouvelle forÃªt Â»** permet dâ€™initialiser un environnement Active Directory isolÃ©, maÃ®trisÃ© et conforme aux bonnes pratiques.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/creation-foret.png" alt="CrÃ©ation de la forÃªt Active Directory" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">CrÃ©ation de la forÃªt racine infra.formation.local</p>
  </div>
</div>

**DÃ©lÃ©gation DNS**  
La crÃ©ation dâ€™une dÃ©lÃ©gation DNS **nâ€™est pas cochÃ©e**.  
Dans le cadre dâ€™une nouvelle forÃªt racine, le serveur hÃ©berge lui-mÃªme le service DNS intÃ©grÃ© Ã  Active Directory.  
Une dÃ©lÃ©gation nâ€™est pertinente que dans un scÃ©nario de sous-domaine ou dâ€™intÃ©gration Ã  une infrastructure DNS existante.


<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/no-dns.png" alt="ne pas ajouter de dns" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">ne pas cocher le DNS</p>
  </div>
</div>


**Mot de passe DSRM**:
Le mot de passe **Directory Services Restore Mode (DSRM)** est dÃ©fini Ã  cette Ã©tape. J'ai choisi une passphrase composÃ©e de chiffres et caractÃ¨res spÃ©ciaux.
Il permet lâ€™accÃ¨s au contrÃ´leur de domaine en mode restauration et doit Ãªtre :
- robuste,
- stockÃ© de maniÃ¨re sÃ©curisÃ©e,
- distinct des comptes administrateurs du domaine.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/mdp-dsrm.png" alt="DÃ©finition du mot de passe DSRM"  style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">DÃ©finition du mot de passe DSRM</p>
  </div>
</div>

Lâ€™assistant propose par dÃ©faut des emplacements standards pour la base de donnÃ©es, les journaux et le dossier **SYSVOL**.  
Dans ce contexte de laboratoire maÃ®trisÃ©, les chemins par dÃ©faut sont conservÃ©s afin de garantir la compatibilitÃ© maximale avec les outils et bonnes pratiques Microsoft.

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/sysvol.png" alt="Configuration du dossier SYSVOL"  style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Emplacement de la base AD, des journaux et du dossier SYSVOL</p>
  </div>
</div>

---

**Installation de la forÃªt**:
Cette Ã©tape rÃ©capitule lâ€™ensemble des paramÃ¨tres choisis prÃ©cÃ©demment.  
Elle permet une derniÃ¨re vÃ©rification avant lâ€™exÃ©cution effective de la promotion.

Une fois validÃ©e, lâ€™installation initialise :
- le schÃ©ma Active Directory,
- les partitions de la forÃªt,
- le service DNS intÃ©grÃ©,
- le partage SYSVOL.


<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/installation-foret.png" alt="Installation de la forÃªt Active Directory"  style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">RÃ©capitulatif et lancement de lâ€™installation de la forÃªt</p>
  </div>
</div>

La promotion se conclut par la validation des paramÃ¨tres et le redÃ©marrage automatique du serveur.  
Ã€ lâ€™issue du redÃ©marrage, lâ€™ouverture de session sâ€™effectue dÃ©sormais via le compte **INFRA\\Administrateur**, confirmant la crÃ©ation effective du domaine.


<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/open-admin-ad.png" alt="ouverture session admin" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Ouverture de la session INFRA\Administrateur</p>
  </div>
</div>

## ğŸ› ï¸ Configuration Post-Promotion 

Une fois le domaine opÃ©rationnel, il est crucial d'ajuster les paramÃ¨tres par dÃ©faut qui sont souvent trop faibles. Ces actions prÃ©parent le terrain pour un audit PingCastle rÃ©ussi.

### Activation de la Corbeille Active Directory

L'activation est rÃ©alisÃ©e en PowerShell. Le systÃ¨me demande une confirmation explicite car cette action est irrÃ©versible, marquant un point de non-retour dans la sÃ©curisation de la disponibilitÃ© des objets.

<div class="flex flex-col items-center my-8">
  <img src="/images/projets/win-infra-core/promo/active-recycle-bin.png" alt="PowerShell Activation Corbeille" class="rounded-lg border border-white/10 shadow-md w-full"/>
  <p class="text-[0.65rem] italic opacity-50 mt-2">Activation et vÃ©rification de la fonctionnalitÃ© 'Recycle Bin Feature'</p>
</div>

La commande **`Get-ADOptionalFeature`** confirme que le pÃ©rimÃ¨tre **(`EnabledScopes`)** couvre dÃ©sormais l'ensemble de la forÃªt `infra.formation.local`.


## ğŸ” Durcissement de la politique de mots de passe Active Directory

### ğŸ§­ Marche Ã  suivre (en bref)
Modifier la *Default Domain Policy* afin dâ€™imposer des mots de passe robustes, limiter les tentatives de connexion et rÃ©duire la surface dâ€™attaque des comptes intÃ©grÃ©s. Cette GPO ne sera modifiÃ©e que pour le strict minimum, nous n'y toucherons plus par la suite. Des GPOs plus ciblÃ©es seront alors crÃ©Ã©es selon les besoins.


### ğŸ“ Renforcement des rÃ¨gles de mots de passe

Par dÃ©faut, Active Directory autorise des mots de passe trop courts au regard des recommandations actuelles de lâ€™ANSSI.  
La **Default Domain Policy** a donc Ã©tÃ© durcie afin dâ€™Ã©lever le niveau de sÃ©curitÃ© global du domaine.

- Longueur minimale du mot de passe : **14 caractÃ¨res**
- Activation de la **complexitÃ©**
- Historique des mots de passe activÃ© pour empÃªcher la rÃ©utilisation

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/gpo-password-length.png" alt="GPO Longueur mot de passe" class="rounded-lg border border-white/10 w-full shadow-md" />
      <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Configuration de la longueur minimale Ã  14 caractÃ¨res</p>
  </div>
</div>

ğŸ” Objectif : rendre les attaques par force brute et par dictionnaire nettement plus coÃ»teuses.


### ğŸ”’ Politique de verrouillage des comptes

Une politique de verrouillage a Ã©tÃ© mise en place afin de bloquer les attaques par dictionnaire en ligne :

- Seuil de verrouillage : **5 tentatives**
- DurÃ©e de verrouillage : **30 minutes**
- RÃ©initialisation automatique du compteur

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/gpo-lockout.png" alt="GPO Verrouillage compte" class="rounded-lg border border-white/10 w-full shadow-md" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Seuil de verrouillage fixÃ© Ã  5 tentatives pour 30 minutes</p>
  </div>
</div>

âš ï¸ **Note de sÃ©curitÃ©**  
Le verrouillage de compte est une mesure Ã  double tranchant : mal calibrÃ©e, elle peut Ãªtre exploitÃ©e pour provoquer un dÃ©ni de service.  
Elle reste nÃ©anmoins indispensable pour bloquer efficacement les attaques automatisÃ©es.


### ğŸ‘¤ HygiÃ¨ne des comptes intÃ©grÃ©s

Le compte **Administrateur intÃ©grÃ©** possÃ¨de un **SID prÃ©visible**, ce qui en fait une cible prioritaire lors des phases de reconnaissance.  
Pour limiter les attaques automatisÃ©es, les actions suivantes ont Ã©tÃ© appliquÃ©es via GPO :


<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/gpo-modif.png" alt="Modifier la GPO Domain Policy" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Modification de la GPO racine</p>
  </div>
</div>

- Renommage du compte **Administrateur**
- Renommage du compte **InvitÃ©**
- Description volontairement neutre et non identifiable

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div class="flex flex-col items-center my-8">
    <img src="/images/projets/win-infra-core/promo/gpo-rename-admin.png" alt="Renommage du compte Administrateur" class="rounded-lg border border-white/10 shadow-md w-full" />
  <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Renommage du compte Administrateur intÃ©grÃ©</p>
  </div>

  <div class="flex flex-col items-center my-8">
    <img src="/images/projets/win-infra-core/promo/gpo-rename-guest.png" alt="Renommage du compte InvitÃ©" class="rounded-lg border border-white/10 shadow-md w-full"/>
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Renommage du compte InvitÃ©</p>
  </div>
</div>

- DÃ©sactivation complÃ¨te du compte **InvitÃ©**

<div style="display: flex; justify-content: center; margin: 2rem 0;">
  <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
    <img src="/images/projets/win-infra-core/promo/guest-disabled.png" alt="DÃ©sactivation du compte InvitÃ©" class="rounded-lg border border-white/10 shadow-md w-full"/>
    <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">DÃ©sactivation du compte InvitÃ© via GPO</p>
  </div>
</div>

ğŸ¯ Objectif : sortir des schÃ©mas dâ€™attaque standards utilisÃ©s par les outils automatisÃ©s.



### âš™ï¸ Application de la stratÃ©gie

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-8">
  <div style="display: flex; justify-content: center; margin: 2rem 0;">
    <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
      <img src="/images/projets/win-infra-core/promo/gpupdate.png" alt="Application de la GPO via PowerShell" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
      <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Application immÃ©diate via gpupdate /force</p>
    </div>
  </div>

  <div style="display: flex; justify-content: center; margin: 2rem 0;">
    <div style="display: flex; flex-direction: column; align-items: center; max-width: 500px;">
      <img src="/images/projets/win-infra-core/promo/activer-gpo.png" alt="Activation de la GPO au niveau du domaine" style="width: 100%; height: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);" />
      <p style="font-size: 0.65rem; text-align: center; opacity: 0.5; margin-top: 8px; font-style: italic;">Application de la Default Domain Policy Ã  lâ€™Ã©chelle du domaine</p>
    </div>
  </div>
</div>

Cette Ã©tape marque la mise en place des fondations du domaine Active Directory : un contrÃ´leur de domaine promu dans un environnement maÃ®trisÃ©, reposant sur une configuration cohÃ©rente et des choix structurants dÃ¨s la crÃ©ation de la forÃªt.

Les premiÃ¨res mesures de durcissement appliquÃ©es, combinÃ©es Ã  une politique de sÃ©curitÃ© renforcÃ©e dÃ¨s lâ€™origine, permettent de rÃ©duire significativement la surface dâ€™attaque et dâ€™Ã©tablir un socle fiable pour les configurations Ã  venir.

La prochaine phase sera consacrÃ©e Ã  lâ€™audit de sÃ©curitÃ© du domaine, afin dâ€™Ã©valuer objectivement le niveau de sÃ©curitÃ© de lâ€™infrastructure et dâ€™identifier les axes dâ€™amÃ©lioration possibles.

<NextStep 
  href="/projets/audit-pingcastle" 
  title="Auditer la sÃ©curitÃ©" 
/>

